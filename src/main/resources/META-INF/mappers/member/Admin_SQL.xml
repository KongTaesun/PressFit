<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- java Resource/src/main/resources/mappers/
    businessMapper.xml -->
<!-- 다른 mapper와 중복되지 않도록 네임스페이스 기재 -->
<mapper namespace="admin">
	<insert id="create" parameterType="kr.co.pressfit.vo.AdminVO">
		insert into Aadmin (id,pw,pw2) values (#{id},#{pw},#{pw2})	
	</insert>
	<select id="read" resultType="kr.co.pressfit.vo.AdminVO">
		select * from Aadmin where pw=#{pw}
	</select>
	
	<select id="readlist" resultType="kr.co.pressfit.vo.AdminVO">
		<include refid="pagingPre"/>
		select * from Aadmin
	    <include refid="pagingPost"/>
	</select>
	<select id="businesslist" resultType="kr.co.pressfit.vo.BusinessVO">
		<include refid="pagingPre"/>
		select * from Cbusiness
	    <include refid="pagingPost"/>
	</select>
	<select id="memberlist" resultType="kr.co.pressfit.vo.MemberVO">
        <include refid="pagingPre"/>
        SELECT * FROM Cmember 
	    <include refid="pagingPost"/>
    </select>
    
	<update id="update"> 
		update Aadmin
		set pw=#{pw}, pw2=#{pw2},name=#{name}
		where id=#{id}
	</update> 
	<update id="update1"> 
	<![CDATA[
		update ${id}
	]]>
		set pw=#{pw}
		where idx=#{idx}
	</update> 
	<update id="update2"> 
	<![CDATA[
		update ${id}
		set warn=warn+1
		where idx=#{idx}
	]]>
	</update> 
	<delete id="delete1"> 
	<![CDATA[
		delete from ${id}
		where idx=#{idx}
	]]>
	</delete> 
	<delete id="delete">
		delete from Aadmin where id=#{id} and pw=#{pw} and pw2=#{pw2}
	</delete>
	<select id="passwordcheck" resultType="int">
		select EXISTS(select * from Aadmin where id=#{id} and pw=#{pw} and pw2=#{pw2})
	</select>
	<sql id="search">
	
	</sql>
	<sql id="pagingPre">
		<![CDATA[
		select @i as TOTAL, AAA.*
		from(
		select
		@i := @i + 1 as RNUM
		, AA.*
		from(
		]]>
	</sql>
	<sql id="pagingPost">
		<![CDATA[
		) AA, (select @i := 0, @j := 0) temp	
		) AAA	
		where AAA.RNUM limit #{START}, #{END}
		]]>
	</sql>
	<select id="community" parameterType="kr.co.pressfit.vo.CommunityVO" resultType="kr.co.pressfit.vo.CommunityVO">
	    <include refid="pagingPre"/>
	    <![CDATA[
		SELECT @ROWNUM:=@ROWNUM+1 AS rownum, b.idx, b.title, b.content, b.writer,DATE_FORMAT(b.regdate, "%Y%m%d") regdate, b.viewcnt,b.ref,b.turn,b.level,
      	(SELECT COUNT(*) FROM CommunityReply WHERE boardno=b.idx) AS recnt
      	FROM CommunityBoard b, Cmember m,(SELECT @ROWNUM := 0) R
      	WHERE b.writer = m.id AND showdel = 'y'
	    ]]>
		<include refid="search"></include>
		ORDER BY b.ref desc,b.turn,b.level
	    <include refid="pagingPost"/>
	</select>
	<select id="faq" resultType="kr.co.pressfit.vo.FaqVO">
	<include refid="pagingPre"/>
	    <![CDATA[
		SELECT @ROWNUM:=@ROWNUM+1 AS rownum, b.idx, b.title, b.content, b.writer,DATE_FORMAT(b.regdate, "%Y%m%d") regdate, b.viewcnt,b.ref,b.turn,b.level,
      	(SELECT COUNT(*) FROM FaqReply WHERE boardno=b.idx) AS recnt
      	FROM FaqBoard b, Cmember m,(SELECT @ROWNUM := 0) R
      	WHERE b.writer = m.id AND showdel = 'y'
		]]>
		<include refid="search"></include>
		ORDER BY b.ref desc,b.turn,b.level
	    <include refid="pagingPost"/>
	</select>
	<select id="gallery" resultType="kr.co.pressfit.vo.GalleryVO">
	    <include refid="pagingPre"/>
	    <![CDATA[
        SELECT @ROWNUM:=@ROWNUM+1 AS rownum, b.idx, b.title, b.content, b.writer, DATE_FORMAT(b.regdate, "%Y%m%d") regdate, b.viewcnt,b.ref,b.turn,b.level,
      	(SELECT COUNT(*) FROM GalleryReply WHERE boardno=b.idx) AS recnt,
      	(SELECT fullname FROM GalleryFile WHERE idx=b.idx ORDER BY GalleryFile.regdate limit 1) AS fullname
      	FROM GalleryBoard b, Cmember m,(SELECT @ROWNUM := 0) R
      	WHERE b.writer = m.id AND showdel = 'y'
		]]>
		<include refid="search"></include>
		ORDER BY b.ref desc,b.turn,b.level
	    <include refid="pagingPost"/>
	</select>
	<select id="tmouse" parameterType="hashmap" resultType="kr.co.pressfit.vo.TMouseVO">
       <include refid="pagingPre"/>
	    <![CDATA[
	      SELECT @ROWNUM:=@ROWNUM+1 AS ROWNUM, b.*,
	      (SELECT COUNT(*) FROM TMouseReply WHERE boardno=b.idx) AS recnt,
	      (SELECT fullName FROM TMouseFile WHERE idx=b.idx ORDER BY TMouseFile.regdate limit 1) AS fullName
	      FROM TMouseBoard b, Cbusiness m,(SELECT @ROWNUM := 0) R
	      WHERE b.crea_id = m.id  AND showdel = 'y' 
	    ]]>
	    <include refid="search"></include>
	    ORDER BY rownum
		<include refid="pagingPost"/>
   </select>
   	<select id="keyboard" resultType="kr.co.pressfit.vo.KeyboardVO">
	     <include refid="pagingPre"/>
	    <![CDATA[
	    SELECT @ROWNUM:=@ROWNUM+1 AS ROWNUM, b.*,
		(SELECT COUNT(*) FROM KeyboardReply WHERE boardno=b.idx) AS recnt,
		(SELECT fullName FROM KeyboardFile WHERE idx=b.idx ORDER BY KeyboardFile.regdate limit 1) AS fullName
		FROM KeyboardBoard b, Cbusiness m,(SELECT @ROWNUM := 0) R
		WHERE b.crea_id = m.id  AND showdel = 'y' 
	    ]]>
		<include refid="search"></include>
		ORDER BY rownum
		<include refid="pagingPost"/>
	</select>
	 
</mapper>

 












