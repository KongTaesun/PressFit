<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="logger">
 
    <insert id="requesttime" parameterType="kr.co.pressfit.vo.LoggerVO">
    	insert into visitant(ip,start,login,id,kind,uri) 
   		value(#{ip},#{start},#{login},#{id},#{kind},#{uri})
    </insert>
    <update id="responsetime" parameterType="kr.co.pressfit.vo.LoggerVO">
    	<selectKey resultType="int" keyProperty="idx" order="BEFORE">
	        SELECT MAX(idx) FROM visitant        
	    </selectKey>
    	update visitant set processtime=#{processtime}, end=#{end} where idx=#{idx}
    </update>
    <select id="allvisit" resultType="int">
    	<![CDATA[select count(@ROWNUM:=@ROWNUM+1) AS cnt 
		from (select * from visitant group by ip) a,(SELECT @ROWNUM := 0) r]]>
    </select>
    <select id="dayvisit" resultType="int">
	    <![CDATA[select count(@ROWNUM:=@ROWNUM+1) AS cnt 
		from (select * from visitant where start like DATE_FORMAT(Now(), '%Y-%m-%d%') group by ip) a,(SELECT @ROWNUM := 0) r]]>
    </select>
    <select id="allsearch" resultType="int">
    	<![CDATA[select count(*) from visitant
		where uri='/pressfit/search/answer.do']]>
    </select>
    <select id="daysearch" resultType="int">
    	<![CDATA[select count(*) from visitant
		where uri='/pressfit/search/answer.do' and start like DATE_FORMAT(Now(), '%Y-%m-%d%')]]>
    </select>
    <select id="processtime" resultType="float">
    	<![CDATA[select avg(processtime) from visitant]]>
    </select>
    <select id="allresponsecount" resultType="int">
    	<![CDATA[select max(idx) from visitant]]>
    </select>
    <select id="dayresponsecount" resultType="int">
    	<![CDATA[select count(*) from visitant 
		where start like DATE_FORMAT(Now(), '%Y-%m-%d%')]]>
    </select>
    <select id="alloreder" resultType="int">
    	<![CDATA[select count(*) from cart_board where shippingStatus=2 or shippingStatus=7]]>
    </select>
    <select id="dayoreder" resultType="int">
    	<![CDATA[select count(*) from cart_board where shippingStatus=2 or shippingStatus=7 and orderdate like DATE_FORMAT(Now(), '%Y-%m-%d%')]]>
    </select>
</mapper>